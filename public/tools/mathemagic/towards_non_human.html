<head>
	<title>我不當人類啦！</title>
	<meta name="description" content="選擇一個項目，看看你能夠在不計算的情況下，背誦到什麼程度？">
</head>
<h2>我不當人類啦！</h2>
<p>選擇以下項目，看看你能夠在不計算的情況下，背誦到什麼程度？</p>
<audio id="wrong_sfx" src="/assets/クイズ不正解1.mp3"></audio>
<section class="genre fix_base">
	<h2>質數<sup>n</sup></h2>
	<div class="test_grid">
		<div class="test_section" id="twos_power" data-count="1">
			<span>2次冪 數列</span>
			<div class="question">
				<p>2<sup><span class="count_value">1</span></sup> = <input type="text" id="2**count"
						placeholder="按enter送出" /></p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="threes_power" data-count="1">
			<span>3次冪 數列</span>
			<div class="question">
				<p>3<sup><span class="count_value">1</span></sup> = <input type="text" id="3**count"
						placeholder="按enter送出" /></p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="fives_power" data-count="1">
			<span>5次冪 數列</span>
			<div class="question">
				<p>5<sup><span class="count_value">1</span></sup> = <input type="text" id="5**count"
						placeholder="按enter送出" /></p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="sevens_power" data-count="1">
			<span>7次冪 數列</span>
			<div class="question">
				<p>7<sup><span class="count_value">1</span></sup> = <input type="text" id="7**count"
						placeholder="按enter送出" /></p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="elevens_power" data-count="1">
			<span>11次冪 數列</span>
			<div class="question">
				<p>11<sup><span class="count_value">1</span></sup> = <input type="text" id="11**count"
						placeholder="按enter送出" /></p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="thirteens_power" data-count="1">
			<span>13次冪 數列</span>
			<div class="question">
				<p>13<sup><span class="count_value">1</span></sup> = <input type="text" id="13**count"
						placeholder="按enter送出" /></p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
	</div>

</section>
<section class="genre fix_exponents">
	<h2>完全冪</h2>
	<div class="test_grid">
		<div class="test_section" id="perfect_squares" data-count="1">
			<span>完全平方數 數列</span>
			<div class="question">
				<p><span class="count_value">1</span><sup>2</sup> = <input type="text" id="count**2"
						placeholder="按enter送出" />
				</p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="perfect_cubes" data-count="1">
			<span>完全立方數 數列</span>
			<div class="question">
				<p><span class="count_value">1</span><sup>3</sup> = <input type="text" id="count**3"
						placeholder="按enter送出" />
				</p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="perfect_quads" data-count="1">
			<span>完全四次方數 數列</span>
			<div class="question">
				<p><span class="count_value">1</span><sup>4</sup> = <input type="text" id="count**4"
						placeholder="按enter送出" />
				</p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<!-- <div class="test_section" id="perfect_pents" data-count="1">
			<span>完全五次方數 數列</span>
			<div class="question"><p><span class="count_value">1</span><sup>5</sup> = <input type="text" id="count**5" placeholder="按enter送出" /></p></div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="perfect_sexts" data-count="1">
			<span>完全六次方數 數列</span>
			<div class="question"><p><span class="count_value">1</span><sup>6</sup> = <input type="text" id="count**6" placeholder="按enter送出" /></p></div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="perfect_septs" data-count="1">
			<span>完全七次方數 數列</span>
			<div class="question"><p><span class="count_value">1</span><sup>7</sup> = <input type="text" id="count**7" placeholder="按enter送出" /></p></div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div> -->
	</div>
</section>
<section class="genre misc">
	<h2>其他</h2>
	<div class="test_grid">
		<div class="test_section" id="fractional_sevenths" data-count="1">
			<span>階乘 數列</span>
			<div class="question">
				<p><span class="count_value">1</span>! = <input type="text"
						id="(function factorial(x) {return (x <= 1) ? 1 : x * factorial(x - 1);})(count)"
						placeholder="按enter送出" />
				</p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section" id="fractional_sevenths" data-count="1">
			<span>費波那契 數列</span>
			<p>Tip: fab(1) = fab(2) = 1</p>
			<div class="question">
				<p>fab(<span class="count_value">1</span>) = <input type="text"
						id="(function fabonacci(x) {return (x == 1 || x == 2) ? 1 : fabonacci(x - 2) + fabonacci(x - 1);})(count)"
						placeholder="按enter送出" /></p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
		<div class="test_section_decimals" id="fractional_sevenths" data-count="1">
			<span>圓周率小數位</span>
			<p>Tip: pi(1) = 1, pi(2) = 4</p>
			<div class="question">
				<p>pi(<span class="count_value">1</span>) = <input type="text"
						id="fetch(`/tools/query/pi/${count}`).then(res => res.json())" placeholder="輸入一位數字自動送出" /></p>
			</div>
			<div class="timer_display">倒數計時：<span class="timer_value">10</span> 秒</div>
			<div class="record_display">最高紀錄：<span class="record_value">--</span></div>
			<button class="reset_btn" style="display:none;">重置數值</button>
		</div>
	</div>
</section>
<script>
	// 倒數計時秒數設定
	const COUNTDOWN_SECONDS = 10;
	const wrongSfx = document.getElementById('wrong_sfx');

	// 初始化每個區段
	document.querySelectorAll('.test_section').forEach(section => {
		let count = parseInt(section.getAttribute('data-count')) || 1;
		let countDisplay = section.querySelector('.count_value');
		let timerDisplay = section.querySelector('.timer_value');
		let recordDisplay = section.querySelector('.record_value');
		let input = section.querySelector('input');
		let resetBtn = section.querySelector('.reset_btn');

		countDisplay.textContent = count;
		timerDisplay.textContent = COUNTDOWN_SECONDS;
		recordDisplay.textContent = '--';

		let timer = null;
		let timeLeft = COUNTDOWN_SECONDS;

		// 重新啟動倒數計時功能
		function startTimer() {
			clearInterval(timer);
			timeLeft = COUNTDOWN_SECONDS;
			timerDisplay.textContent = timeLeft;
			timer = setInterval(() => {
				timeLeft--;
				timerDisplay.textContent = timeLeft;
				if (timeLeft <= 0) {
					clearInterval(timer);
					input.disabled = true;
					input.value = '';
					resetBtn.style.display = 'inline-block';
					timerDisplay.textContent = "--";
					recordDisplay.textContent = Math.max(count - 1, Number(recordDisplay.textContent) || 0); // 更新最高紀錄
				}
			}, 1000);
		}

		// 按下Enter鍵處理
		input.addEventListener('keydown', e => {
			startTimer();
			if (e.key === 'Enter' && !input.disabled) {
				e.preventDefault();

				if (input.value !== eval(section.querySelector('input').id).toString()) {
					console.log('錯誤');
					wrongSfx.play();
					input.value = '';
					return;
				}

				// 清除輸入框
				input.value = '';

				// 數值 +1 並更新顯示及 data-count
				count++;
				section.setAttribute('data-count', count);
				countDisplay.textContent = count;

				// 重啟倒數計時
				startTimer();
			}
		});

		// 重置按鈕功能
		resetBtn.addEventListener('click', () => {
			count = 1;
			section.setAttribute('data-count', count);
			countDisplay.textContent = count;
			input.disabled = false;
			resetBtn.style.display = 'none';
			startTimer();
		});

		// 啟動初始倒數計時
		// startTimer();
	});

	document.querySelectorAll('.test_section_decimals').forEach(section => {
		let count = parseInt(section.getAttribute('data-count')) || 1;
		let countDisplay = section.querySelector('.count_value');
		let timerDisplay = section.querySelector('.timer_value');
		let recordDisplay = section.querySelector('.record_value');
		let input = section.querySelector('input');
		let resetBtn = section.querySelector('.reset_btn');

		countDisplay.textContent = count;
		timerDisplay.textContent = COUNTDOWN_SECONDS;
		recordDisplay.textContent = '--';

		let timer = null;
		let timeLeft = COUNTDOWN_SECONDS;

		// 重新啟動倒數計時功能
		function startTimer() {
			clearInterval(timer);
			timeLeft = COUNTDOWN_SECONDS;
			timerDisplay.textContent = timeLeft;
			timer = setInterval(() => {
				timeLeft--;
				timerDisplay.textContent = timeLeft;
				if (timeLeft <= 0) {
					stopTimer();
				}
			}, 1000);
		}

		function stopTimer() {
			clearInterval(timer);
			input.disabled = true;
			input.value = '';
			resetBtn.style.display = 'inline-block';
			timerDisplay.textContent = "--";
			recordDisplay.textContent = Math.max(count - 1, Number(recordDisplay.textContent) || 0); // 更新最高紀錄
		}


		// 輸入數值立即處理
		input.addEventListener('input', async e => {

			// return;
			if (!"0123456789".includes(input.value)) {
				input.value = '';
				return;
			}
			if (!input.disabled) {
				//e.preventDefault();

				if (input.value !== (await eval(section.querySelector('input').id)).toString()) {
					input.value = '';
					wrongSfx.play();
					stopTimer();

					return;
				}

				// 清除輸入框
				input.value = '';

				// 數值 +1 並更新顯示及 data-count
				count++;
				section.setAttribute('data-count', count);
				countDisplay.textContent = count;

				// 重啟倒數計時
				startTimer();
			}
		});


		// 重置按鈕功能
		resetBtn.addEventListener('click', () => {
			count = 1;
			section.setAttribute('data-count', count);
			countDisplay.textContent = count;
			input.disabled = false;
			resetBtn.style.display = 'none';
			startTimer();
		});

		// 啟動初始倒數計時
		// startTimer();
	});
</script>
<style>
	.fix_base {
		background-color: #0ff5;
	}

	.fix_exponents {
		background-color: #ff05;
	}

	.misc {
		background-color: #0f05;
	}

	.genre {
		margin-bottom: 20px;
		padding: 10px;
		border-radius: 10px;
	}

	.test_grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
		gap: 20px;
		justify-items: center;
	}

	.test_section,
	.test_section_decimals {
		border: 1px solid #aaa;
		padding: 10px;
		margin-bottom: 20px;
		width: 250px;
		position: relative;
		border-radius: 10px;
	}

	.test_section .question,
	.test_section_decimals .question {
		display: flex;
		flex-direction: column;
		align-items: center;
	}

	input:disabled {
		background-color: #eee;
	}

	.reset_btn {
		margin-top: 8px;
	}

	.timer_display {
		margin-top: 5px;
	}
</style>